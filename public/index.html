<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вхід та Реєстрація</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="showForm('login')">Вхід</div>
        <div class="tab" onclick="showForm('register')">Реєстрація</div>
    </div>

    <!-- Форма для входу -->
    <div id="login" class="form active">
        <h2>Вхід</h2>
        <form>
            <div class="form-group">
                <label for="login-name">Ім'я</label>
                <input type="name" id="login-name" placeholder="Введіть ім'я користувача" required>
            </div>
            <div class="form-group">
                <label for="login-password">Пароль</label>
                <input type="password" id="login-password" placeholder="Введіть пароль" required>
            </div>
            <div>
                <p id="error-messege"></p>
            </div>
            <button type="submit" class="btn" onclick="handleLogin()">Увійти</button>
        </form>
    </div>

    <!-- Форма для реєстрації -->
    <div id="register" class="form">
        <h2>Реєстрація</h2>
        <form>
            <div class="form-group">
                <label for="register-name">Ім'я</label>
                <input type="text" id="register-name" placeholder="Введіть ім'я" required>
            </div>
            <div class="form-group">
                <label for="register-password">Пароль</label>
                <input type="password" id="register-password" placeholder="Введіть пароль" required>
            </div>
            <button type="submit" class="btn" onclick="handleRegister()">Зареєструватися</button>
        </form>
    </div>

    <div id="taskPanel" class="form">
        <h2>Обчислення площі криволінійної трапеції</h2>
        <form>
            <div class="form-group">
                <label for="func-input">Функція</label>
                <input type="text" id="func-input" placeholder="Введіть функцію" required>
    
                <label for="start-range">Початок відрізку</label>
                <input type="number" id="start-range" placeholder="Введіть початок відрізку" required>
    
                <label for="end-range">Кінець відрізку</label>
                <input type="number" id="end-range" placeholder="Введіть кінець відрізку" required>
    
                <label for="step">Крок обчислення</label>
                <input type="number" id="step" step="any" placeholder="Введіть крок" required>
            </div>
            <button type="submit" class="btn" onclick="SendTask()">Обчислити</button>
        </form>
    
        <div>
            <p id="result"></p>
        </div>
    </div>
</div>

<script>

    let currentUser = '';
    // Функція для перемикання між формами
    function showForm(formId) {
        // Видаляємо активний клас у всіх вкладках і формах
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.form').forEach(form => form.classList.remove('active'));

        // Додаємо активний клас для вибраної вкладки і форми
        document.querySelector(`[onclick="showForm('${formId}')"]`).classList.add('active');
        document.getElementById(formId).classList.add('active');
    }

    async function handleLogin()
    {
        const loginNameField = document.getElementById('login-name').value;
        const loginPasswordField = document.getElementById('login-password').value;
        event.preventDefault();
        if(loginNameField.trim() === "" || loginPasswordField.trim() === "")
        {
            console.log("null")
        }
        else
        {

            const response = await fetch('/login-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ loginName: loginNameField, loginPassword: loginPasswordField })
            });

            const serverResponse = await response.json();
            console.log(serverResponse);

            if(response.ok)
            {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.form').forEach(form => form.classList.remove('active'));

                document.getElementById('taskPanel').classList.add('active');
                currentUser = serverResponse.userId;
                console.log(currentUser);
            }
            else
            {
                console.log(serverResponse);
                changeErrorText(serverResponse);
            }

        }
    }

    async function handleRegister()
    {
        const registerNameField = document.getElementById('register-name').value;
        const registerPasswordField = document.getElementById('register-password').value;
        event.preventDefault();
        
        if(registerNameField.trim() === "" || registerPasswordField.trim() === "")
        {
            console.log("null")
        }
        else
        {

            const response = await fetch('/register-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ registerName: registerNameField, registerPassword: registerPasswordField })
            });

            const serverResponse = await response.text();
            console.log(serverResponse);

            if(response.ok)
            {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.form').forEach(form => form.classList.remove('active'));

                document.getElementById('taskPanel').classList.add('active');
                console.log(serverResponse);
            }
            else
            {
                console.log(serverResponse);
                changeErrorText(serverResponse);
            }
        }
    }

    async function SendTask()
    {
        event.preventDefault();
        const func = document.getElementById('func-input').value;
        const rangeStart = document.getElementById().value;
        const rangeEnd = document.getElementById().value;
        const step = document.getElementById().value;

        if(func.trim() === "" || rangeStart === "" || rangeEnd === "" || step === "")
        {
            console.log("null")
        }
        else
        {
            const response = await fetch('/task')
        }

    }

    function changeErrorText(message) {
        var paragraph = document.getElementById("error-messege");
        paragraph.innerText = message;
    }

</script>

</body>
</html>
